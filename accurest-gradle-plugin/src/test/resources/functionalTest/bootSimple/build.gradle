buildscript {
	repositories {
		mavenCentral()
	}
}

apply plugin: 'groovy'
apply plugin: 'accurest'

ext {
	contractsDir = file("${project.rootDir}/repository/mappings/com/ofg")
	wireMockStubsOutputDirRoot = file("${project.buildDir}/production/${project.name}-stubs/")
	wireMockStubsOutputDir = new File(wireMockStubsOutputDirRoot, 'repository/mappings/')
}

configurations {
	all {
		resolutionStrategy {
			eachDependency { DependencyResolveDetails details ->
				// To prevent an accidental usage of groovy-all.jar and groovy.jar in different versions
				// all modularized Groovy jars are replaced with groovy-all.jar by default.
				if (details.requested.group == 'org.codehaus.groovy' && details.requested.name != "groovy-all") {
					details.useTarget("org.codehaus.groovy:groovy-all:${details.requested.version}")
				}
			}
		}
	}
}

repositories {
	mavenCentral()
}

dependencies {
	compile "org.springframework:spring-web:$springVersion"
	compile "org.springframework:spring-context-support:$springVersion"
	compile "org.codehaus.groovy:groovy-all:2.4.5"
	compile 'com.fasterxml.jackson.core:jackson-databind:2.4.4'
	compile 'com.jayway.jsonpath:json-path-assert:2.0.0'

	testCompile "com.github.tomakehurst:wiremock:2.0.5-beta"
	testCompile "org.spockframework:spock-spring:1.0-groovy-2.4"
	testCompile "com.jayway.restassured:rest-assured:$restAssuredVersion"
	testCompile "com.jayway.restassured:spring-mock-mvc:$restAssuredVersion"
	testCompile "ch.qos.logback:logback-classic:1.1.2"
}

accurest {
	baseClassForTests = 'com.ofg.twitter.places.BaseMockMvcSpec'
	basePackageForTests = 'accurest'
	contractsDslDir = contractsDir
//	generatedTestSourcesDir = file("${project.rootDir}/src/test/groovy/")
	stubsOutputDir = wireMockStubsOutputDir
}

//TODO: Put it into the plugin
task createWireMockStubsOutputDir << {
	wireMockStubsOutputDir.mkdirs()
}

generateWireMockClientStubs.dependsOn { createWireMockStubsOutputDir }
generateAccurest.dependsOn generateWireMockClientStubs

wrapper {
	gradleVersion '2.2.1'
}
